<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>    
    <link rel="stylesheet" href="../CSS/perfil.css">
    <script src="../JS/login.js"></script>

    <title>Couple Pets</title>
</head>

<body onload="Carregar ();">
    <header>
        <main>
            <nav class="navbar navbar-expand-lg navbar-light" style="background-color: rgb(127, 212, 248);">
                <div class="container-fluid">
                    <a class="logo" href="#"><img src="../img/logo.png" alt="logo"
                            style="max-width: 285px; max-height: 103px"></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Perfil</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="Cadastro de Pet.html">Meu Pet</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="Contatos.html">Contato</a>
                            </li>

                            <li class="nav-item sobre">
                                <a class="nav-link" href="Sobre.html">Sobre</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" onclick="deslogar()" href="PaginaInicial.html">Sair</a>
                            </li>
                        </ul>
                        <form class="d-flex" role="search">
                            <input class="form-control me-2" type="search" placeholder="Busque pets"
                                aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Buscar</button>
                        </form>
                    </div>
                </div>
            </nav>
        </main>
    </header>
    <aside>
        <section class="wrapper grid grid-template row-gap">
            <div class="box-lateral nav-lateral">
                <ul>
                    <a href="#"><button class="botao botao-ativo">Perfil</button></a><br>
                    <a href="Cadastro de Pet.html"><button class="botao botao-desativado">Meu
                            Pet</button></a><br>
                    <a href="Contatos.html"><button class="botao botao-desativado">Contatos</button></a><br>
                    <a href="Sobre.html"><button class="botao botao-desativado">Sobre</button></a><br>
                </ul>
            </div>
            <section class="content">
                <div class="">
                    <div class="perfil">
                        <nav class="perfil">
                            <h2>Perfil</h2>
                        </nav>
                    </div>
                </div>
                <div class="content">
                    <form id="bloco">
                        <div>
                            <figure>

                            </figure>
                        </div>
                        <div>
                            <div class="enviar-foto">
                                <label class="custom-file-upload button-sub">
                                    <input accept="image/*" type='file' id="imgInp" style="padding-top: 10px;" />
                                    Enviar arquivo
                                </label>
                                <img src="../img/user-profile.png" alt="profile-image" id="blah"
                                    style="width: 190px; height: 190px; border-radius: 20%;">
                            </div>
                        </div>
                        <div class="alinhamento">
                            <div class="box-noticia1">
                                <div id="main-form-perfil-bloco1-campo">
                                    Nome
                                    <span style="color: cadetblue" ;>*</span>
                                    :
                                </div>
                                <br clear="both">
                                <div id="main-form-perfil-bloco1-campo">
                                    Data de nascimento

                                    :
                                </div>
                                <br clear="both">
                                <div id="main-form-perfil-bloco1-campo">
                                    Gênero

                                    :
                                </div>
                                <br clear="both">
                                <div id="main-form-perfil-bloco1-campo">
                                    Endereço
                                    <span style="color: cadetblue" ;>*</span>
                                    :
                                </div>
                                <br clear="both">
                                <div id="main-form-perfil-bloco1-campo">
                                    Telefone
                                    <span style="color: cadetblue" ;>*</span>
                                    :
                                </div>

                                <br clear="both">
                                <div id="main-form-perfil-bloco1-campo">
                                    Estado/Cidade
                                    <span style="color: cadetblue" ;>*</span>
                                    :
                                </div>
                                <br clear="both">
                            </div>
                            <div class="box-noticia2">
                                <div class="bloco2-nome campo">
                                    <label for="nome "></label>
                                    <input type="text" name="nome" id="nome" placeholder="Ex: João Pedro" required>
                                </div>
                                <div class="bloco2-date ">
                                    <label for="date"></label>
                                    <input type="date" name="nome" id="dtaNasc">
                                </div>
                                <div class="bloco2-genero ">
                                    <form name="genderForm" class="pe" >
                                        <input type="radio" name="gender" id="Masculino"
                                            value="Masculino" required> Masculino
                                        <input type="radio" name="gender" id="Feminino"
                                            value="Feminino" required> Feminino
                                    </form>
                                </div>
                                <div class="bloco2-adress ">
                                    <label for="adress"></label>
                                    <input type="text" id="endereco" required>
                                </div>
                                <div class="bloco2-tel">
                                    <label for="tel"></label>
                                    <input type="number" id="tel" required>
                                </div>

                                <div class="bloco2-state ">
                                    <select id="cidade" onchange="buscaCidades(this.value)" required>
                                        <option value="">SELECIONE</option>
                                        <option value="Belo Horizonte">Belo Horizonte</option>
                                    </select>
                                </div>
                                <button class="button-sub" type="submit" onclick="Salvar();">Concluído</button>
                            </div>
                        </div>
                    </form>
                    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

                    <script src="perfil.js"></script>
                </div>
            </section>
        </section>
    </aside>
    <div class="item footer">
        <footer class="bg-light text-center text-lg-start">
            <!-- Copyright -->
            <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
                © 2022 Copyright:
                <a class="text-dark" href="https://pucminas.br">PUC Minas</a>
            </div>
            <!-- Copyright -->
        </footer>
    </div>

    <script>
        /*document.querySelector('#imgInp').addEventListener("change", function () {
            const reader = new FileReader();

            reader.addEventListener("load", () => {
                localStorage.setItem("imagem-recente", reader.result)
            });

            reader.readAsDataURL(this.files[0]);
        })


        document.addEventListener("DOMContentLoaded", () => {
            const dadoUrlImagemRecente = localStorage.getItem("imagem-recente");
            if (dadoUrlImagemRecente) {
                document.querySelector("#blah").setAttribute("src", dadoUrlImagemRecente);
            }
        });


        imgInp.onchange = evt => {
            const [file] = imgInp.files
            if (file) {
                blah.src = URL.createObjectURL(file)
            }
        }*/

        function Salvar() {
            
            let cadastrosArmazenado =JSON.parse(localStorage.getItem('cadastro'));
            const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"))
            const novosDados = {
                nome: document.getElementById("nome").value,
                dtaNasc: document.getElementById("dtaNasc").value,
                gender:  document.querySelector('input[name="gender"]:checked').value,
                endereco: document.getElementById("endereco").value,
                tel: document.getElementById("tel").value,
                cidade: document.getElementById("cidade").value
            }
            cadastrosArmazenado.forEach(item => {
                
                if (item.id==usuarioLogado){
                    Object.assign(item, novosDados)
                }
            });
            
            console.log(cadastrosArmazenado[0])
            localStorage.setItem('cadastro',JSON.stringify(cadastrosArmazenado));       
        }

        function Carregar () {
            const cadastrosArmazenado =JSON.parse(localStorage.getItem('cadastro'));
            const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"))
            const dadosUsuarioLogado = cadastrosArmazenado.find(item=>item.id==usuarioLogado)
            document.getElementById("nome").value = dadosUsuarioLogado.nome  || "";
            document.getElementById("dtaNasc").value = dadosUsuarioLogado.dtaNasc || "&nbsp"            
            const radio = document.getElementById(dadosUsuarioLogado.gender)
            radio.checked = true;            
            document.getElementById("endereco").value = dadosUsuarioLogado.endereco || "&nbsp"
            document.getElementById("tel").value = dadosUsuarioLogado.tel || "&nbsp"
            document.getElementById("cidade").value = dadosUsuarioLogado.cidade  || "&nbsp"           
        }
    </script>
</body>

</html>